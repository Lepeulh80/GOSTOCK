(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[982],{8069:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var a=r(7294);function n({onClose:e,onAdd:t,prefill:r}){let[n,l]=(0,a.useState)({name:"",category:"",stock:0,alert_threshold:5,buy_price:0,sell_price:0,notes:"",barcode:""}),[o,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r&&l(e=>({...e,...r}))},[r]);let u=e=>{let{name:t,value:r}=e.target;l(e=>({...e,[t]:r}))},i=async()=>{try{if(!n.name)return alert("Le nom du produit est requis");c(!0);let r={name:n.name,category:n.category||"general",stock:parseInt(n.stock,10)||0,alert_threshold:parseInt(n.alert_threshold,10)||5,buy_price:parseFloat(n.buy_price)||0,sell_price:parseFloat(n.sell_price)||0,notes:n.notes||"",barcode:n.barcode||null,created_at:new Date().toISOString()};await t(r),e()}catch(e){alert(e.message||"Erreur")}finally{c(!1)}};return a.createElement("div",{className:"modal-card p-4 border rounded",role:"dialog","aria-modal":"true"},a.createElement("h3",null,"Ajouter un produit"),a.createElement("label",null,"Nom",a.createElement("input",{name:"name","aria-label":"Nom",value:n.name,onChange:u})),a.createElement("label",null,"Cat\xe9gorie",a.createElement("input",{name:"category",value:n.category,onChange:u})),a.createElement("label",null,"Stock initial",a.createElement("input",{name:"stock",value:n.stock,onChange:u,type:"number"})),a.createElement("label",null,"Seuil d'alerte",a.createElement("input",{name:"alert_threshold",value:n.alert_threshold,onChange:u,type:"number"})),a.createElement("label",null,"Prix d'achat",a.createElement("input",{name:"buy_price",value:n.buy_price,onChange:u,type:"number",step:"0.01"})),a.createElement("label",null,"Prix de vente",a.createElement("input",{name:"sell_price",value:n.sell_price,onChange:u,type:"number",step:"0.01"})),a.createElement("label",null,"Notes",a.createElement("textarea",{name:"notes",value:n.notes,onChange:u})),a.createElement("label",null,"Code-barres",a.createElement("input",{name:"barcode",value:n.barcode,onChange:u})),a.createElement("div",{style:{display:"flex",gap:8,marginTop:8}},a.createElement("button",{onClick:i,disabled:o},o?"Ajout...":"Ajouter"),a.createElement("button",{onClick:e},"Annuler")))}},6546:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return n}});var a=r(7294);function n({product:e,onClose:t,onUpdate:r}){let[n,l]=(0,a.useState)(null);if((0,a.useEffect)(()=>l(e?{...e}:null),[e]),!n)return null;let o=e=>l({...n,[e.target.name]:e.target.value}),c=async()=>{try{let e={name:n.name,category:n.category,stock:parseInt(n.stock,10)||0,alert_threshold:parseInt(n.alert_threshold,10)||0,buy_price:parseFloat(n.buy_price)||0,sell_price:parseFloat(n.sell_price)||0,notes:n.notes||"",barcode:n.barcode||null};await r(n.id,e),t()}catch(e){alert(e.message||"Erreur")}};return a.createElement("div",{className:"modal-card p-4 border rounded",role:"dialog"},a.createElement("h3",null,"Modifier le produit"),a.createElement("label",null,"Nom",a.createElement("input",{name:"name",value:n.name,onChange:o})),a.createElement("label",null,"Cat\xe9gorie",a.createElement("input",{name:"category",value:n.category,onChange:o})),a.createElement("label",null,"Stock",a.createElement("input",{name:"stock",value:n.stock,onChange:o,type:"number"})),a.createElement("label",null,"Seuil d'alerte",a.createElement("input",{name:"alert_threshold",value:n.alert_threshold,onChange:o,type:"number"})),a.createElement("label",null,"Prix d'achat",a.createElement("input",{name:"buy_price",value:n.buy_price,onChange:o,type:"number",step:"0.01"})),a.createElement("label",null,"Prix de vente",a.createElement("input",{name:"sell_price",value:n.sell_price,onChange:o,type:"number",step:"0.01"})),a.createElement("label",null,"Notes",a.createElement("textarea",{name:"notes",value:n.notes,onChange:o})),a.createElement("label",null,"Code-barres",a.createElement("input",{name:"barcode",value:n.barcode,onChange:o})),a.createElement("div",{style:{display:"flex",gap:8,marginTop:8}},a.createElement("button",{onClick:c},"Sauvegarder"),a.createElement("button",{onClick:t},"Annuler")))}},4622:function(e,t,r){"use strict";let a;r.r(t),r.d(t,{default:function(){return m}});var n=r(7294);{let{createClient:e}=r(1323),t="https://stock_app_autocreate.supabase.co",n="your-anon-public-key";t&&n||console.warn("Supabase environment variables are not set. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY"),a=e(t,n)}var l=r(8069),o=r(6546);function c({products:e=[],onAdd:t,onUpdate:r,onDelete:a,onPrefill:c}){let[u,i]=(0,n.useState)(!1),[s,m]=(0,n.useState)(null);return n.createElement("div",{className:"card p-3 mt-3"},n.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},n.createElement("h3",null,"Produits"),n.createElement("button",{onClick:()=>{c&&c(),i(!0)}},"Nouveau")),n.createElement("table",{style:{width:"100%",marginTop:8}},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",null,"Nom"),n.createElement("th",null,"Cat\xe9gorie"),n.createElement("th",null,"Stock"),n.createElement("th",null,"Seuil"),n.createElement("th",null,"Prix vente"),n.createElement("th",null,"Actions"))),n.createElement("tbody",null,e.map(e=>n.createElement("tr",{key:e.id},n.createElement("td",null,e.name),n.createElement("td",null,e.category),n.createElement("td",null,e.stock),n.createElement("td",null,e.alert_threshold),n.createElement("td",null,e.sell_price),n.createElement("td",null,n.createElement("button",{onClick:()=>m(e)},"Modifier"),n.createElement("button",{onClick:()=>{confirm("Supprimer ?")&&a(e.id)}},"Supprimer")))))),u&&n.createElement(l.default,{onClose:()=>i(!1),onAdd:t}),s&&n.createElement(o.default,{product:s,onClose:()=>m(null),onUpdate:r}))}var u=r(6369),i=r.n(u);function s({onDetected:e,onError:t,onLookup:r}){let a=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(a.current)return i().init({inputStream:{type:"LiveStream",target:a.current,constraints:{facingMode:"environment"}},decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","upc_reader","upc_e_reader"]}},function(e){if(e){t&&t(e);return}i().start()}),i().onDetected(t=>{try{let a=t.codeResult.code;"function"==typeof r?r(a):e&&e(a)}catch(e){}}),()=>{try{i().stop()}catch(e){}i().offDetected&&i().offDetected()}},[e,t,r]),n.createElement("div",{ref:a,style:{width:"100%",height:300,background:"#000"},"aria-label":"scanner"})}function m(){let{products:e,loading:t,error:r,addProduct:u,updateProduct:i,deleteProduct:m,fetchProducts:d,getProductByBarcode:p}=function(){let[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{l(!0);let{data:e,error:r}=await a.from("products").select("*").order("created_at",{ascending:!1});r?c(r):t(e||[]),l(!1)},[]);(0,n.useEffect)(()=>{u()},[u]);let i=async e=>{if(!e)return null;l(!0);let{data:t,error:r}=await a.from("products").select("*").eq("barcode",e).maybeSingle();return(l(!1),r)?(console.error(r),null):t||null},s=async e=>{l(!0);let{data:r,error:n}=await a.from("products").insert([e]).select().single();if(l(!1),n)throw n;return t(e=>[r,...e]),r},m=async(e,r)=>{l(!0);let{data:n,error:o}=await a.from("products").update(r).eq("id",e).select().single();if(l(!1),o)throw o;return t(t=>t.map(t=>t.id===e?n:t)),n},d=async e=>{l(!0);let{error:r}=await a.from("products").delete().eq("id",e);if(l(!1),r)throw r;return t(t=>t.filter(t=>t.id!==e)),!0};return{products:e,loading:r,error:o,fetchProducts:u,getProductByBarcode:i,addProduct:s,updateProduct:m,deleteProduct:d}}(),[E,f]=(0,n.useState)(!1),[b,h]=(0,n.useState)(null),[y,g]=(0,n.useState)(null),[_,v]=(0,n.useState)(!1),C=async e=>{let t=await u(e);return t&&t.id&&g(t),t},x=async(e,t)=>{await i(e,t)},S=async e=>{confirm("Confirmer la suppression")&&await m(e)},k=e=>{f(!1),alert("Code d\xe9tect\xe9: "+e+" — vous pouvez l'associer \xe0 un produit (si non trouv\xe9 vous serez invit\xe9 \xe0 cr\xe9er).")},w=async e=>{try{let t=await p(e);if(t)g(t);else{let t=confirm('Aucun produit trouv\xe9 pour le code-barres "'+e+'".\nVoulez-vous cr\xe9er automatiquement un produit minimal avec ce code ? (Vous pourrez le modifier ensuite)');if(t){let t={name:"Produit "+e,category:"non-definie",stock:0,alert_threshold:0,buy_price:0,sell_price:0,notes:"Cr\xe9\xe9 automatiquement apr\xe8s scan",barcode:e,created_at:new Date().toISOString()};try{let e=await C(t);e&&e.id?(alert("Produit cr\xe9\xe9: "+e.name+" — ouverture de la modale \xc9diter."),g(e)):alert("Le produit a \xe9t\xe9 cr\xe9\xe9 mais la r\xe9ponse ne contient pas d'id. Actualisez la page.")}catch(e){console.error(e),alert("Erreur lors de la cr\xe9ation automatique: "+(e.message||e))}}else h({barcode:e,name:"",category:"non-definie"}),v(!0)}f(!1)}catch(e){console.error(e),alert("Erreur lors de la recherche du code-barres")}};return n.createElement("section",{className:"card p-4 border rounded mt-4"},n.createElement("h2",{className:"text-lg font-semibold mb-2"},"Produits"),n.createElement("div",{style:{display:"flex",gap:8,marginBottom:12}},n.createElement("button",{onClick:()=>f(e=>!e)},E?"Fermer scanner":"Ouvrir scanner")),E&&n.createElement(s,{onDetected:k,onError:e=>alert("Scanner erreur: "+(e.message||e)),onLookup:w}),t&&n.createElement("div",null,"Chargement..."),r&&n.createElement("div",{style:{color:"red"}},"Erreur: ",r.message),n.createElement(c,{products:e,onAdd:C,onUpdate:x,onDelete:S,onPrefill:()=>{h(null),v(!0)}}),b&&n.createElement("div",{style:{marginTop:8}},"Pr\xe9-remplissage d\xe9tect\xe9: ",JSON.stringify(b)," — la modale Nouveau est ouverte."),y&&n.createElement("div",{style:{marginTop:8}},"Produit trouv\xe9 pour \xe9dition: ",y.name," — la modale Modifier est ouverte."),_&&n.createElement(l.default,{prefill:b,onClose:()=>{v(!1),h(null)},onAdd:C}),y&&n.createElement(o.default,{product:y,onClose:()=>g(null),onUpdate:x}))}},6235:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/products/page",function(){return r(4622)}])}},function(e){e.O(0,[72,888,774,179],function(){return e(e.s=6235)}),_N_E=e.O()}]);